!function(s){function e(e){for(var t,n,r=e[0],o=e[1],i=e[2],a=0,c=[];a<r.length;a++)n=r[a],Object.prototype.hasOwnProperty.call(f,n)&&f[n]&&c.push(f[n][0]),f[n]=0;for(t in o)Object.prototype.hasOwnProperty.call(o,t)&&(s[t]=o[t]);for(v&&v(e);c.length;)c.shift()();return u.push.apply(u,i||[]),l()}function l(){for(var e,t=0;t<u.length;t++){for(var n=u[t],r=!0,o=1;o<n.length;o++){var i=n[o];0!==f[i]&&(r=!1)}r&&(u.splice(t--,1),e=a(a.s=n[0]))}return e}var n={},f={app:0},u=[];function a(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return s[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=s,a.c=n,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var t=window.webpackJsonp=window.webpackJsonp||[],r=t.push.bind(t);t.push=e,t=t.slice();for(var o=0;o<t.length;o++)e(t[o]);var v=r;u.push([128,"vendor"]),l()}({128:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(129);var o=r(n(130));window.addEventListener("DOMContentLoaded",function(){new o.default("#renderCanvas").doRender()})},130:function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var m=r(n(80)),w=n(80),b=o(n(132)),M=n(133),S=n(0),y=n(134),P=n(135),x=n(136),_=n(139),C=n(99),V=n(137),O=o(n(138)),i=(a.prototype.createBasicEnv=function(){var r=this,e=new m.HemisphericLight("hLight",new m.Vector3(-.3,1,-.3),this.scene);e.diffuse=new w.Color3(.3,.3,.3),e.groundColor=new w.Color3(.1,.1,.15);var t=new m.Vector3(-5,30,0),o=new m.Vector3(0,-1,0),i=new m.SpotLight("sLight",t,o,Math.PI/3,2,this.scene);i.falloffType=w.Light.FALLOFF_GLTF,i.innerAngle=Math.PI/6,i.diffuse=new w.Color3(.5,.75,1),i.shadowMinZ=1,i.shadowMaxZ=100;var a=new m.ShadowGenerator(1024,i,!0);a.filter=C.ShadowGenerator.FILTER_POISSONSAMPLING,console.log(a.bias),this.camera=y.createCamera(this.canvas,this.scene);var n=this.engine.getRenderWidth(),c=this.engine.getRenderHeight();this.rt=new m.RenderTargetTexture("rt1",{width:n,height:c},this.scene,!1,!0,w.Engine.TEXTURETYPE_FLOAT,!1,m.Texture.BILINEAR_SAMPLINGMODE,!1,!1,!1,w.Engine.TEXTUREFORMAT_R,!1),this.engine.loadingUIText="Loading...",this.rt.activeCamera=this.camera;var s=b.default();this.scene.clearColor=new S.Color4(0,0,0,1),this.scene.addMesh(s);var l=this.scene.enableDepthRenderer();l.useOnlyInActiveCamera=!0;var f=m.MeshBuilder.CreatePlane("ground",{width:70,height:70},this.scene),u=new _.SimpleMaterial("ground",this.scene);f.material=u,f.rotate(w.Vector3.Right(),Math.PI/2),f.position.y=-7,f.receiveShadows=!0,u.diffuseColor=new w.Color3(.5,.5,.5),O.default(this.scene,this.engine,a);var v=M.generateBackfacMaterial(this.scene);v.setTexture("textureSampler",l.getDepthMap());var h=P.generateIntegralMaterial(this.scene);h.setTexture("textureSampler",this.rt);var d=V.generateMarchMaterial(this.scene);d.setTexture("backFaceSampler",this.rt),this.rt.renderList=new Array,this.rt.renderList.push(s);var p=x.BeamType.No;x.createUIForBeam(function(e){p=e});var g=0;this.scene.onBeforeRenderObservable.add(function(){g+=.01,i.direction.z=-.3;var e=new m.Vector3(5*Math.cos(g),10,5*Math.sin(g)+3);i.position=e,s.position=e,h.setVector2("halfWH",y.GetNearWH(r.camera)),h.setVector3("lightPos",e),s.lookAt(e.add(o)),s.scaling=new w.Vector3(20,20,20),s.layerMask=2;var t=y.GetNearRect(r.camera);d.setVector3("center",t.center),d.setVector3("right",t.right),d.setVector3("up",t.up),d.setVector3("centerF",t.centerF),d.setVector3("rightF",t.rightF),d.setVector3("upF",t.upF),d.setVector3("lightPos",e),d.setMatrix("shadowMat",a.getTransformMatrix());var n=a.getShadowMapForRendering();n&&d.setTexture("shadowSampler",n)}),this.scene.onAfterRenderObservable.add(function(){s.material,s.material=v,s.layerMask=1,r.rt.render(!1),s.layerMask=2;var e=s.subMeshes;p!=x.BeamType.No&&(p==x.BeamType.Integral?s.material=h:s.material=d,e.forEach(function(e){s.render(e,!0)})),r.engine.setAlphaMode(w.Engine.ALPHA_DISABLE),r.engine.setDepthWrite(!0)})},a.prototype.doRender=function(){var e=this;this.engine.runRenderLoop(function(){e.scene.render()}),window.addEventListener("resize",function(){e.engine.resize()})},a);function a(e){this.canvas=document.querySelector(e),this.engine=new m.Engine(this.canvas,!0,{},!0),this.scene=new m.Scene(this.engine),this.engine.getCaps().textureFloatRender&&(this.engine.getCaps().textureHalfFloatRender=!1),this.createBasicEnv()}t.default=i},132:function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var f=r(n(80)),u=n(80);t.default=function(){var e=new Float32Array(1542);e[0]=e[1]=e[2]=0;for(var t=0;t<16;t++)for(var n=0;n<32;n++){var r=32*t+n,o=Math.cos(.5*Math.PI*t/16);e[3*r+3]=Math.cos(2*Math.PI*n/32)*o,e[3*r+4]=Math.sin(2*Math.PI*n/32)*o,e[3*r+5]=Math.sqrt(3)+Math.sin(Math.PI*t*.5/16)}e[1539]=e[1540]=0,e[1541]=Math.sqrt(3)+1;var i=new Uint16Array(3072);for(n=0;n<32;n++)i[3*n+0]=0,i[3*n+1]=n+1,i[3*n+2]=(n+1)%32+1,i[2976+3*n+0]=513,i[2976+3*n+1]=i[3*n+2]+480,i[2976+3*n+2]=i[3*n+1]+480;for(t=1;t<16;t++)for(n=0;n<32;n++){var a=6*(32*(t-1)+n)+96,c=n+1,s=(n+1)%32+1;i[0+a]=32*(t-1)+c,i[1+a]=32*t+c,i[2+a]=32*(t-1)+s,i[3+a]=32*(t-1)+s,i[4+a]=32*t+c,i[5+a]=32*t+s}var l=new f.Mesh("light");return l.setVerticesData(u.VertexBuffer.PositionKind,e,!1,3),l.setIndices(i),l}},133:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(80);t.generateBackfacMaterial=function(e){r.Effect.ShadersStore.backfaceVertexShader="\n    precision highp float;\n\n    // Attributes\n    attribute vec3 position;\n    \n    // Uniforms\n    uniform mat4 worldViewProjection;\n    \n    // Varying\n    varying vec4 positionS;\n   \n    \n    void main(void) {\n        positionS = worldViewProjection * vec4(position, 1.0);\n        gl_Position = positionS;\n    }\n    ",r.Effect.ShadersStore.backfaceFragmentShader="\n    precision highp float;\n    uniform sampler2D textureSampler;\n    uniform mat4 wrojection;\n\n    varying vec4 positionS;\n    varying vec3 positionM;\n\n    void main(void) {\n        float n = 1.0f;\n        float f = 100.0f;\n        vec2 uv = vec2(positionS.x/positionS.w, positionS.y/positionS.w);\n        uv = (uv +1.0)*0.5;\n        vec4 tex = texture2D(textureSampler, uv);\n        float z = (positionS.w - n) / (f - n);\n        z = min(z,tex.r);\n        gl_FragColor = vec4(z,0,0,0);\n    }\n    ";var t=new r.ShaderMaterial("backface",e,{vertex:"backface",fragment:"backface"},{attributes:["position"],uniforms:["world","worldView","worldViewProjection","view","projection"]});return t.sideOrientation=r.Orientation.CW,t}},134:function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var d=r(n(80)),p=n(80);t.createCamera=function(e,t){var n=new d.ArcRotateCamera("arcam",-2,Math.PI/2,20,d.Vector3.Zero(),t);return n.upperBetaLimit=Math.PI/1.5,n.lowerRadiusLimit=5,n.upperRadiusLimit=50,n.attachControl(e,!1),n.maxZ=100,n.minZ=1,n.fov=Math.PI/2,n.layerMask=1,t.activeCamera=n},t.GetNearWH=function(e){var t=e.getEngine().getRenderWidth(),n=e.getEngine().getRenderHeight(),r=Math.tan(e.fov/2)*e.minZ,o=r*t/n;return new p.Vector2(o,r)},t.GetNearRect=function(e){var t=e.getEngine().getRenderWidth(),n=e.getEngine().getRenderHeight(),r=Math.tan(e.fov/2)*e.minZ,o=r*t/n,i=p.Matrix.Invert(e.getViewMatrix(!0)),a=d.Vector3.TransformCoordinates(new p.Vector3(o,0,e.minZ),i),c=d.Vector3.TransformCoordinates(new p.Vector3(0,r,e.minZ),i),s=d.Vector3.TransformCoordinates(new p.Vector3(0,0,e.minZ),i);a.subtractInPlace(s),c.subtractInPlace(s);var l=Math.tan(e.fov/2)*e.maxZ,f=l*t/n,u=d.Vector3.TransformCoordinates(new p.Vector3(f,0,e.maxZ),i),v=d.Vector3.TransformCoordinates(new p.Vector3(0,l,e.maxZ),i),h=d.Vector3.TransformCoordinates(new p.Vector3(0,0,e.maxZ),i);return u.subtractInPlace(h),v.subtractInPlace(h),{center:s,up:c,right:a,centerF:h,upF:v,rightF:u}}},135:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(80);t.generateIntegralMaterial=function(e){r.Effect.ShadersStore.integralVertexShader="\n    precision highp float;\n\n    // Attributes\n    attribute vec3 position;\n    \n    // Uniforms\n    uniform mat4 worldViewProjection;\n    uniform mat4 view;\n    uniform vec3 lightPos;\n\n    // Varying\n    varying vec4 positionS;\n    varying vec3 positionM;\n    varying vec3 viewLightPos;\n\n    \n    void main(void) {\n        positionM = position;\n        positionS = worldViewProjection * vec4(position, 1.0);\n        viewLightPos= (view * vec4(lightPos,1.0)).xyz;\n        gl_Position = positionS;\n    }\n    ",r.Effect.ShadersStore.integralFragmentShader="\n    precision highp float;\n    uniform sampler2D textureSampler;\n    uniform vec2 halfWH;\n    \n    varying vec3 viewLightPos;\n    varying vec4 positionS;\n    varying vec3 positionM;\n\n    void main(void) {\n        float n = 1.0f;\n        float f = 100.0f;\n        vec2 uv = vec2(positionS.x/positionS.w, positionS.y/positionS.w);\n        vec2 nxy = halfWH * uv;\n        \n        uv = (uv +1.0)*0.5;\n        vec4 tex = texture2D(textureSampler, uv);\n       \n      \n        float z = positionS.w;\n        float backZ = tex.r * (f - n)+n;\n        if(z >= backZ){\n            gl_FragColor = vec4(0,0,0,1.0);\n\n            return;\n        }\n        vec3 nP = vec3(nxy*z, z);\n        vec3 fP = vec3(nxy*backZ, backZ);\n        \n        vec3 va = nP - viewLightPos;\n        vec3 vb = fP - viewLightPos;\n        vec3 vc = fP - nP;\n\n\n        float a = sqrt(dot(va,va));\n        float b = sqrt(dot(vb,vb));\n        float c = sqrt(dot(vc,vc));\n        \n        float a2 = a * a;\n        float b2 = b * b;\n        float c2 = c * c;\n\n        float p = (a + b + c) * 0.5;\n        float s = sqrt(p*(p-a)*(p-b)*(p-c));\n        float h = s*2.0/c;\n        float gc = sqrt(h*h+1.0);\n        \n        float low = sqrt(max(0.0,a2-h*h));\n        float up = sqrt(max(0.0,b2-h*h));\n        if(a2+c2 > b2)low = -low;\n        if(b2+c2 < a2)up = -up;\n        float res = ((atan(up/gc) - atan(low/gc))/gc) * 4.0;\n        gl_FragColor = vec4(res*vec3(0.5,0.75,1.0),1.0);\n    }\n    ";var t=new r.ShaderMaterial("integral",e,{vertex:"integral",fragment:"integral"},{attributes:["position"],uniforms:["world","worldView","worldViewProjection","view","projection"]});return t.sideOrientation=r.Orientation.CCW,t.disableDepthWrite=!0,t.alphaMode=r.Engine.ALPHA_ADD,t}},136:function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i,o,a=r(n(140));(o=i=t.BeamType||(t.BeamType={}))[o.No=0]="No",o[o.Integral=1]="Integral",o[o.March=2]="March",t.createUIForBeam=function(e){var t=a.AdvancedDynamicTexture.CreateFullscreenUI("myUI"),n=a.Button.CreateSimpleButton("noBeam","no beam");n.left="-40%",n.top="-40%",n.width=.2,n.height=.08,n.color="#ffffff";var r=a.Button.CreateSimpleButton("integralBeam","integral beam");r.left="-40%",r.top="-30%",r.width=.2,r.height=.08,r.color="#ffffff";var o=a.Button.CreateSimpleButton("marchBeam","march beam");o.left="-40%",o.top="-20%",o.width=.2,o.height=.08,o.color="#ffffff",t.addControl(n),t.addControl(r),t.addControl(o),n.onPointerClickObservable.add(function(){e(i.No)}),r.onPointerClickObservable.add(function(){e(i.Integral)}),o.onPointerClickObservable.add(function(){e(i.March)})}},137:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(80);t.generateMarchMaterial=function(e){r.Effect.ShadersStore.marchVertexShader="\n    precision highp float;\n\n    // Attributes\n    attribute vec3 position;\n    uniform mat4 world;\n\n    // Uniforms\n    uniform mat4 worldViewProjection;\n    uniform mat4 view;\n\n    // Varying\n    varying vec4 positionS;\n    varying vec3 positionW;\n\n    \n    void main(void) {\n        positionW = (world * vec4(position, 1.0)).xyz;\n        positionS = worldViewProjection * vec4(position, 1.0);\n        gl_Position = positionS;\n    }\n    ",r.Effect.ShadersStore.marchFragmentShader="\n    precision highp float;\n    uniform sampler2D backFaceSampler;\n    uniform sampler2D shadowSampler;    \n    uniform mat4 shadowMat;\n    uniform vec3 lightPos;\n    uniform vec3 center;\n    uniform vec3 right;\n    uniform vec3 up;\n\n    uniform vec3 centerF;\n    uniform vec3 rightF;\n    uniform vec3 upF;\n    \n    varying vec4 positionS;\n        varying vec3 positionW;\n\n\n    void main(void) {\n        float n = 1.0f;\n        float f = 100.0f;\n        vec2 uv = vec2(positionS.x/positionS.w, positionS.y/positionS.w);\n        vec3 nxyz = center + right * uv.x + up * uv.y;\n        vec3 fxyz = centerF + rightF * uv.x + upF * uv.y;\n\n        uv = (uv +1.0)*0.5;\n        vec4 tex = texture2D(backFaceSampler, uv);\n      \n        float z = (positionS.w - n)/(f-n);\n        float backZ = tex.r;\n        if(z >= backZ){\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n            return;\n        }\n        \n        vec3 nP = positionW;\n        vec3 fP = nxyz * (1.0 - backZ) + fxyz * backZ ;\n        vec3 vc = fP - nP;\n\n\n        float c = sqrt(dot(vc,vc));\n        \n        float c2 = c * c;\n        float res = 0.0;\n        float k = 1.0/(f-n);\n        for(float i = 0.0; i < 64.0; i=i+1.0){\n            float w = i/64.0;\n            vec3 p = nP * (1.0 - w) + fP * w;\n            vec4 sp = shadowMat*vec4(p,1.0);\n            vec3 depth = (sp.xyz/sp.w +1.0)* 0.5;\n   \n            float shadow = texture2D(shadowSampler, depth.xy).r;\n            if(depth.x >1.0 || depth.y > 1.0 || depth.x < 0.0 || depth.y < 0.0)shadow=1.0;\n            if(shadow>(sp.w-n)*k){\n                vec3 vl = p - lightPos;\n                float l = dot(vl,vl);\n                res += (4.0/(l + 1.0));  \n            }\n        }\n        res = res *c / 64.0;\n        gl_FragColor = vec4(res*vec3(0.5,0.75,1.0),1.0);    \n    }\n    ";var t=new r.ShaderMaterial("march",e,{vertex:"march",fragment:"march"},{attributes:["position"],uniforms:["world","worldView","worldViewProjection","view","projection"]});return t.sideOrientation=r.Orientation.CCW,t.disableDepthWrite=!0,t.alphaMode=r.Engine.ALPHA_ADD,t}},138:function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=n(80),a=r(n(80)),c=n(0);t.default=function(e,t,n){var r=a.MeshBuilder.CreateBox("model",{width:40,height:5,depth:1});e.addMesh(r);var o=new i.StandardMaterial("model",e);r.material=o,r.position.y=-3,r.position.z=-2,n&&n.addShadowCaster(r),o.ambientColor=new c.Color3(.2,.2,.2),o.specularColor=new c.Color3(0,0,0)}}});